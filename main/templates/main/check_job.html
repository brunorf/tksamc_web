{% extends "main/base.html" %}
{% load static %}
{% block html_header %}
{% if not finished %}
<meta http-equiv="refresh" content="10">
{% endif %}
{% endblock %}
{% block content %}
<br/>
<div class="container">
    <div class="row">
        <div class="col-sm-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3>Job results {% if finished %}for {{job_name}} ({{job_id}}){% endif %}</h3>
                </div>
                <div class="panel-body">
                  {% if not finished %}
                    {% if job_name != '' %}
                    Please wait, the job {{job_name}} ({{job_id}}) is still running.
                    {% else %}
                    Please wait, the job {{job_id}} is still running.
                    {% endif %}
                  {% else %}
                  {% with 'jobs'|add:'/'|add:job_id|add:'/'|add:archive_name|add:'.zip' as job_archive %}
                  <a href="{% static job_archive %}">Get your job files here</a>
                  {% endwith %}
                  {% if not image2 %}
                  <br/><br/>
                  <a data-toggle='collapse' href='#collapseExample' aria-expanded='false' aria-controls='collapseExample'>
                    Show script output
                  </a>
                  <div class='collapse' id='collapseExample'>
                    <div class='card card-block'>
                    {{ stdout|safe }}
                    </div>
                  </div>
                  {% endif %}

                    <br/><br/>
                    {% with 'jobs'|add:'/'|add:job_id|add:'/'|add:output_file as output_file_url %}
                    Output file: <a href="{% static output_file_url %}" target="_blank">click here</a>
                    {% endwith %}
                    <br/>
                    {% with 'jobs'|add:'/'|add:job_id|add:'/'|add:output_file_summary as output_file_summary_url %}
                    Output file summary: <a href="{% static output_file_summary_url %}" target="_blank">click here</a>
                    {% endwith %}
                    <br/><br/>

                    {% with 'jobs'|add:'/'|add:job_id|add:'/'|add:image1 as image1_url %}
                    <figure class="figure center-block text-justify">
                        <img src="{% static image1_url %}" class="figure-img img-fluid img-responsive" width="800">
                        <figcaption class="figure-caption" style="display: table-caption; caption-side: bottom;">
                            Charge-charge interaction energy &Delta;G<sub>qq</sub> calculated by the TKSA-MC model for each ionizable residue
                        </figcaption>
                    </figure>
                    {% endwith %}
                    {% if image2 %}
                    <br/>
                    {% with 'jobs'|add:'/'|add:job_id|add:'/'|add:image2 as image2_url %}
                    <figure class="figure center-block text-justify">
                        <img src="{% static image2_url %}" class="figure-img img-fluid img-responsive" width="800">
                        <figcaption class="figure-caption" style="display: table-caption; caption-side: bottom;">
                            &Delta;G<sub>elec</sub> as a function of pH calculated from pH 2 to 12.
                        </figcaption>
                    </figure>
                    {% endwith %}
                    {% endif %}
                  {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
